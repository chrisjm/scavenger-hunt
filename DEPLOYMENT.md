# ðŸš€ Deployment Guide â€“ Netlify + Turso

This project is deployed as a **serverless SvelteKit app on Netlify**, with **Turso/libsql** as the primary database. There is no separate Node/PM2 server or Nginx layer to manage.

## 1. Prerequisites

- Netlify account
- Turso (or compatible libsql) account
- Git repository for this project
- Node.js 18+ locally and `pnpm` for running tooling

## 2. Database (Turso/libsql) setup

1. **Create a Turso database** in the Turso dashboard or CLI.
2. Obtain the **database URL** and **auth token**.
   - Example URL: `libsql://your-db.turso.io`
3. Configure your local `.env` (for running migrations and seeding):

```bash
cp .env.example .env

# In .env
DATABASE_URL="libsql://your-db.turso.io"
DATABASE_AUTH_TOKEN="your_turso_auth_token"
```

4. Run the Drizzle setup against Turso (from your local machine):

```bash
pnpm db:push   # apply schema
pnpm db:seed   # seed initial scavenger-hunt data
```

These commands use `drizzle.config.ts` and `DATABASE_URL` to create/update tables in your Turso instance.

> **Note:** For local-only development you can instead set `DATABASE_URL=local.db` to use a file-based libsql database. For production, use Turso.

## 3. Production environment variables (Netlify)

In your Netlify site settings, configure the following environment variables for the **production** environment (and any other branches/environments you use):

- `DATABASE_URL` â€“ your Turso `libsql://` URL.
- `DATABASE_AUTH_TOKEN` â€“ Turso auth token.
- `GEMINI_API_KEY` â€“ production Gemini API key.
- `JWT_SECRET` â€“ long, random string for signing JWTs.
- `AWS_ACCESS_KEY_ID` / `AWS_SECRET_ACCESS_KEY` / `AWS_REGION` â€“ AWS IAM credentials and region for S3.
- `S3_BUCKET` / `S3_PREFIX` â€“ S3 bucket name and prefix for uploads.

These mirror the variables used in `.env` for local development but are managed through Netlifyâ€™s UI instead of a `.env` file in production.

## 4. Netlify site configuration

1. **Create a new site** from Git in Netlify and connect this repository.
2. In the build settings:
   - **Base directory**: the root of this repo (or adjust if different).
   - **Build command**: `pnpm build`
   - **Framework**: Netlify should auto-detect **SvelteKit** with `@sveltejs/adapter-netlify`.
3. Netlify will:
   - Install dependencies using `pnpm` (based on `pnpm-lock.yaml`).
   - Run `pnpm build`.
   - Deploy the generated static assets and Netlify Functions generated by the adapter.

No custom Nginx or PM2 configuration is required; Netlify handles routing, SSL, and scaling.

## 5. Deployment flow

Typical production flow:

1. Push to the configured branch (e.g. `main`).
2. Netlify automatically starts a build using the latest commit.
3. If the build succeeds, Netlify promotes the new build to production.

You can also trigger manual deploys from the Netlify UI, or use Deploy Previews for feature branches.

## 6. Migrations for future changes

When you change the database schema:

1. Update the Drizzle schema in `src/lib/server/db/schema.ts`.
2. Run the Drizzle commands locally against your Turso database:

```bash
pnpm db:push     # or use db:generate + db:migrate depending on your workflow
```

3. Optionally re-run seeds if appropriate:

```bash
pnpm db:seed
```

Because the app is serverless, there is no long-lived server container where migrations run; you typically run them from a trusted machine (your local dev environment or a CI job) pointed at the same Turso instance.

## 7. Backups & observability

- **Database backups**: Handled via Tursoâ€™s built-in backup/export tools or scheduled dumps from the Turso CLI or dashboard. The old `backup.sh` script for copying a local SQLite file is no longer used in production.
- **Application logs**: Use Netlify logs and any observability integrations you configure.

## 8. Local production preview

You can run a local production build to sanity-check changes before pushing:

```bash
pnpm build
pnpm preview
```

This uses the same SvelteKit + Netlify adapter build pipeline that Netlify runs in its CI environment.

Your Scavenger Hunt app should now be live on Netlify, backed by Turso. ðŸŽ„âœ¨
