# Feature Specification: Dynamic AI Scoring & "The Holiday Spirit Meter"

## 1. Overview

**Objective:** Replace the current binary "Pass/Fail" + "Confidence Level" system with a gamified, subjective AI scoring system (0-100 points).
**Goal:** Increase user engagement by rewarding creativity, composition, and humor, rather than just object detection.
**Role:** The AI will act as the "Holiday Huntmaster," a witty and slightly sarcastic judge.

---

## 2. Database Schema Changes

_Modify the `Submissions` table/collection to accommodate detailed scoring data._

### New Fields

| Field Name        | Type        | Description                                                                   |
| :---------------- | :---------- | :---------------------------------------------------------------------------- |
| `total_score`     | Integer     | Final calculated score (0-100).                                               |
| `score_breakdown` | JSON/Object | Stores the granular points: `{ accuracy: int, composition: int, vibe: int }`. |
| `ai_comment`      | String      | The witty feedback text generated by the AI.                                  |

### Migration Strategy (Backward Compatibility)

_For existing records where `total_score` is NULL:_

1.  **If `is_approved` is TRUE:**
    - Set `total_score` = 50.
    - Set `score_breakdown` = `{ "accuracy": 50, "composition": 0, "vibe": 0 }`.
    - Set `ai_comment` = "Legacy submission. Approved by the Council of Elders."
2.  **If `is_approved` is FALSE:**
    - Set `total_score` = 0.
    - Set `score_breakdown` = `{ "accuracy": 0, "composition": 0, "vibe": 0 }`.
    - Set `ai_comment` = "Legacy submission. Rejected."

---

## 3. Backend Logic: AI Prompt Engineering

### System Prompt

Replace the current object detection prompt with the following Persona and Logic:

```text
### ROLE
You are the "Holiday Huntmaster," a witty, spirited, and slightly sarcastic AI judge for a Scavenger Hunt game.

### GOAL
Analyze the user's photo against the {TASK_DESCRIPTION}. Output a JSON object with a score (0-100) and commentary.

### SCORING ALGORITHM
1. ACCURACY (Max 50 pts):
   - 0 pts: Item missing/unrelated.
   - 25 pts: Item present but debatable/hard to see.
   - 50 pts: Item clearly visible.
   *CRITICAL: If Accuracy is 0, Total Score must be 0.*

2. COMPOSITION (Max 25 pts):
   - Reward good lighting, framing, and focus.
   - Deduct for blurry/dark photos.

3. THE VIBE (Max 25 pts):
   - Bonus for Creativity (clever interpretation).
   - Bonus for Humor (funny angles, pets included).
   - Bonus for Local Flavor.

### OUTPUT FORMAT (JSON ONLY)
{
  "score": integer,
  "breakdown": {
    "accuracy": integer,
    "composition": integer,
    "vibe": integer
  },
  "is_approved": boolean, // True if accuracy >= 25
  "comment": "string" // 1-2 sentences. Witty, encouraging, or gently roasting.
}

```

### User Message Structure

Send the following to the LLM:

1. **Task Description:** `[Insert Item Name/Description]`
2. **Image:** `[Base64 Image or URL]`

---

## 4. Frontend UI Updates

### A. Submission Result View

_Replace the "Confidence %" display with a "Score Card"._

**UI Component Mockup:**

> **Total Score: 85/100**
>
> - âœ… Accuracy: +50
> - ðŸŽ¨ Composition: +15
> - ðŸŒ´ Vibe Check: +20
>
> **Judge's Verdict:** _"I love that you put sunglasses on the reindeer. Very aesthetic, very San Diego."_

### B. Leaderboard View

- **Ranking Logic:** Sort users by Sum of `total_score` (descending) instead of Count of `approved_submissions`.
- **Tie-Breaker:** Earliest submission time.

---

## 5. Implementation Steps for Agent

1. **DB Migration:** Create a script to backfill existing submissions using the 50/0 logic described in Section 2.
2. **Backend Service:** Update the LLM API call to use the new System Prompt and parse the returned JSON.
3. **Data Saving:** Ensure the parsed JSON (`breakdown` and `comment`) is saved to the database.
4. **Frontend - Results:** Update the "Photo Upload" success state to display the breakdown and comment.
5. **Frontend - Leaderboard:** Update the query to sum points rather than count rows.
6. **Frontend - Submission for Task:** Update the submission to show the scoring breakdown.

---

## 6. Edge Cases

- **JSON Parse Error:** If the AI fails to return valid JSON, default to: Score 0, Comment: "The judges are confused. Please try again."
- **Inappropriate Content:** If the AI detects NSFW content (usually handled by safety filters), ensure the app handles the refusal gracefully (Score 0).
